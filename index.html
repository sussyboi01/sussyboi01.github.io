<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Classroom</title>
<style>
  body { 
    margin:0; 
    font-family:sans-serif; 
    background:#14142b; 
    color:white; 
    overflow:hidden; 
    display:flex; 
    justify-content:center; 
    align-items:center; 
    height:100vh;
  }
  .sidebar { 
    width:320px; 
    background:#14142b; 
    padding:40px 20px; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    justify-content:center; 
    border-radius:12px;
    border:2px solid #252550;
    box-shadow:0 0 20px rgba(90,90,255,0.5);
  }
  .sidebar h1 { 
    font-size:28px; 
    margin-bottom:30px; 
    text-shadow:0 0 15px #5a5aff; 
    text-align:center;
  }
  #launchBtn { 
    background:#5a5aff; 
    border:none; 
    padding:20px 30px; 
    border-radius:12px; 
    cursor:pointer; 
    font-size:20px; 
    color:white; 
    transition:0.2s; 
    position:relative;
    z-index:1;
  }
  #launchBtn:hover { 
    background:#7878ff; 
  }
  #deviceIdBar {
    position:fixed;
    left:12px;
    right:12px;
    bottom:12px;
    background:rgba(0,0,0,0.55);
    border:1px solid rgba(90,90,255,0.25);
    color:#fff;
    padding:8px 12px;
    border-radius:10px;
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
    font-family:monospace;
    font-size:13px;
    box-shadow:0 6px 18px rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
  }
  #deviceIdText { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:80%; }
  #copyBtn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.12);
    color:white;
    padding:6px 8px;
    border-radius:8px;
    cursor:pointer;
    font-size:12px;
  }
  #dummyBtn {
    position:absolute;
    inset:-10px;
    z-index:2;
    background:transparent;
    border:none;
    cursor:pointer;
    display:none;
  }
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <h1>boyz for the games v2</h1>
  <div style="position:relative; width:100%; display:flex; justify-content:center;">
    <button id="launchBtn">Open da game</button>
    <button id="dummyBtn"></button>
  </div>
  <div data-fillout-id="rzTyMH4aynus"
       data-fillout-embed-type="popup"
       data-fillout-dynamic-resize
       data-fillout-inherit-parameters
       data-fillout-popup-size="small"
       style="cursor:pointer; display:inline-block; background:#5a5aff; color:white; padding:10px 15px; border-radius:8px; font-family:sans-serif; font-weight:bold; text-align:center; margin-top: 20px; user-select:none;">
    Open form to submit device ID (people who are very berry sussy and dont know what ts is, its at the bottom boi)
  </div>
  <script src="https://server.fillout.com/embed/v1/"></script>
</div>

<script>
  // --- CONFIGURATION ---
  const CONFIG = {
    enabled: false, // Set to false to disable the redirect
    redirectUrl: "https://classroom.google.com"
  };

  // --- LOGIC ---
  (function enforceChromeOS() {
    if (!CONFIG.enabled) return;
    const isChromeOS = navigator.userAgent.includes("CrOS");
    if (!isChromeOS) {
      window.location.replace(CONFIG.redirectUrl);
    }
  })();
</script>

<div id="deviceIdBar" style="display: flex; align-items: center; justify-content: flex-start; gap: 10px;">
  <small style="margin: 0;">Device ID</small>
  <div id="deviceIdText" style="margin: 0; width: auto;">generating…</div>
  <button id="copyBtn" style="margin: 0;">Copy</button>
</div>

<script>
(async function() {
  const STORAGE_KEY = 'device_id_v1';
  const ALLOWED_IDS_URL = "https://sussyboi01.github.io/sixsendysussybaka67mangoboisixboi12345/allowed-ids.json";

  // --- Custom Alert ---
  function customAlert(msg) {
    let overlay = document.getElementById("customAlertOverlay");
    if(!overlay){
      overlay = document.createElement("div");
      overlay.id = "customAlertOverlay";
      overlay.style.cssText = "position:fixed; inset:0; background:rgba(0,0,0,0.55); backdrop-filter:blur(6px); display:flex; align-items:center; justify-content:center; z-index:999999;";
      const box = document.createElement("div");
      box.id = "customAlertBox";
      box.style.cssText = "background:#1a1a35; padding:22px 26px; border-radius:14px; border:2px solid #5a5aff44; box-shadow:0 0 25px rgba(90,90,255,0.6); max-width:300px; text-align:center; color:white; font-family:sans-serif; transform:scale(0.8); opacity:0; transition:0.2s ease;";
      const text = document.createElement("div");
      text.id = "customAlertMsg";
      text.style.cssText = "margin-bottom:18px; font-size:16px; line-height:1.4;";
      box.appendChild(text);
      const btn = document.createElement("button");
      btn.id = "customAlertBtn";
      btn.textContent = "OK";
      btn.style.cssText = "background:#5a5aff; border:none; padding:10px 20px; font-size:15px; border-radius:10px; color:white; cursor:pointer; box-shadow:0 0 15px rgba(90,90,255,0.5); transition:0.2s;";
      box.appendChild(btn);
      overlay.appendChild(box);
      document.body.appendChild(overlay);
      btn.addEventListener("click", () => {
        box.style.opacity = "0";
        box.style.transform = "scale(0.8)";
        setTimeout(() => overlay.style.display = "none", 150);
      });
    }
    const box = document.getElementById("customAlertBox");
    const text = document.getElementById("customAlertMsg");
    overlay.style.display = "flex";
    text.textContent = msg;
    setTimeout(() => {
      box.style.opacity = "1";
      box.style.transform = "scale(1)";
    }, 50);
  }

  // --- Device ID ---
  async function getOrCreateDeviceId() {
    let id = localStorage.getItem(STORAGE_KEY);
    if (id) return id;

    id = await new Promise(resolve => {
      const request = indexedDB.open('deviceDB', 1);
      request.onupgradeneeded = () => request.result.createObjectStore('ids');
      request.onsuccess = () => {
        const db = request.result;
        const tx = db.transaction('ids', 'readonly');
        const store = tx.objectStore('ids');
        const getRequest = store.get(STORAGE_KEY);
        getRequest.onsuccess = () => resolve(getRequest.result);
        getRequest.onerror = () => resolve(null);
      };
      request.onerror = () => resolve(null);
    });

    if (id) {
      localStorage.setItem(STORAGE_KEY, id);
      return id;
    }

    id = crypto.randomUUID();
    localStorage.setItem(STORAGE_KEY, id);

    const dbRequest = indexedDB.open('deviceDB', 1);
    dbRequest.onupgradeneeded = () => dbRequest.result.createObjectStore('ids');
    dbRequest.onsuccess = () => {
      const db = dbRequest.result;
      const tx = db.transaction('ids', 'readwrite');
      tx.objectStore('ids').put(id, STORAGE_KEY);
    };

    return id;
  }

  const deviceId = await getOrCreateDeviceId();
  document.getElementById('deviceIdText').textContent = deviceId;
  document.getElementById('copyBtn').addEventListener('click', () => {
    navigator.clipboard.writeText(deviceId).then(() => customAlert("Copied!"));
  });

  // --- Periodic sync in case localStorage is cleared ---
  setInterval(async () => {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) {
      const db = await new Promise(resolve => {
        const request = indexedDB.open('deviceDB',1);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => resolve(null);
      });
      if(db){
        const tx = db.transaction('ids','readonly');
        const store = tx.objectStore('ids');
        const getRequest = store.get(STORAGE_KEY);
        getRequest.onsuccess = () => {
          if(getRequest.result) {
            localStorage.setItem(STORAGE_KEY,getRequest.result);
            document.getElementById('deviceIdText').textContent = getRequest.result;
          }
        };
      }
    }
  }, 5000);

  const launchBtn = document.getElementById('launchBtn');
  const dummyBtn = document.getElementById('dummyBtn');
  let allowed = false;

  async function fetchAllowedIDs(){
    try {
      const res = await fetch(ALLOWED_IDS_URL + "?t=" + Date.now());
      const data = await res.json();
      const allowedIDs = data.map(e => e.id);
      allowed = allowedIDs.includes(deviceId);
      dummyBtn.style.display = allowed ? "none" : "block";
      launchBtn.disabled = !allowed;
    } catch(err){
      console.error(err);
      allowed = false;
      dummyBtn.style.display = "block";
      launchBtn.disabled = true;
    }
  }

  await fetchAllowedIDs();
  if(!allowed) customAlert("boiii ur so sussyyyy");
  setInterval(fetchAllowedIDs, 120000);

  dummyBtn.addEventListener('click', () => customAlert("bud ur not getting ts u sussy boi"));

  launchBtn.addEventListener('click', async () => {
    if (!allowed) return customAlert("bud ur not getting ts u sussy boi");

    const newWindow = window.open('about:blank', '_blank', 'width=1366,height=768,resizable=yes');
    if (!newWindow) return customAlert("Pop-up blocked! Allow pop-ups.");

    // Set up proper styling for the new window
    newWindow.document.documentElement.style.overflow = 'hidden'; 
    newWindow.document.body.style.margin = '0'; 
    newWindow.document.body.style.padding = '0';
    newWindow.document.body.style.backgroundColor = 'black'; 

    // Temporary loading
    newWindow.document.body.innerHTML = `<div style="color:white;font-family:sans-serif;text-align:center;margin-top:50px;">Loading…</div>`;

    // ⭐ FIX: Add cache-busting parameter to force fresh fetch
    const cacheBuster = Date.now();
    const gameUrl = `https://cdn.jsdelivr.net/gh/sussyboi01/wsrdkgmsjfghjsdaifcjsdfgjhrfadawdwsgdfgdfgwer/index.html?cb=${cacheBuster}`;

    let html;
    try {
      const res = await fetch(gameUrl, {
        cache: 'no-store', // Additional cache prevention
        headers: {
          'Cache-Control': 'no-cache, no-store, must-revalidate',
          'Pragma': 'no-cache'
        }
      });
      html = await res.text();
    } catch (err) {
      console.error(err);
      newWindow.document.body.innerHTML = "<h1 style='color:red;'>Error loading game.</h1>";
      return;
    }

    // Inject the game via iframe
    const iframe = newWindow.document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.height = '100%';
    iframe.style.border = 'none';
    iframe.style.position = 'absolute';
    iframe.style.top = '0';
    iframe.style.left = '0';
    iframe.srcdoc = html.replace("new URL(url, location.origin).hostname", '""');
    
    newWindow.document.body.innerHTML = '';
    newWindow.document.body.appendChild(iframe);
    
    // Redirect current window to Google Classroom
    window.location.href = "https://classroom.google.com";
  });

})();
</script>
</body>
</html>
